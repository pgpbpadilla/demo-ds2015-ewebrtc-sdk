# Node.js DHS for AT&T Enhanced WebRTC JavaScript SDK

This Node.js Developer Hosted Server (DHS) is a node application that enables you to manage the following:

* Configuration options for the SDK's sample application
* App configuration (app key, app secret, redirect_uri, etc.)
* AT&T OAuth token creation using credentials and scope
* E911 ID creation

## Contents of this Package

This package contains the software necessary to run a DHS for
a Node.js sample Web app.

- `/package.json` - Configuration options
- `/att-webrtc-dhs.js` - Main Node.js program

## Configuring the DHS

The following configuration options are located in `/package.json`:

### DHS-Specific Configuration

```javascript
"dhs_config": {
  "dhs_host": "localhost",
  "api_env": "sandbox",
  "http_port": 10010,
  "https_port": 10011,
  "cert_file": "dhs.cert",
  "key_file": "dhs.key",
  "dhs_name": "att.webrtc.dhs",
  "cors_domains": [
    "your.test.com:9001",
    "*.prod.com:9001",
    "*.sandbox.myapp.com:9001",
    "0.0.0.0:9001",
    "localhost:9001",
    "127.0.0.1:9001"]
}
```
### WebRTC-API Specific Configuration

```javascript
"sandbox": {
  "api_endpoint": "https://api.att.com",
  "app_key": "YourAppKey",
  "app_secret": "YourAppSecret",
  "oauth_callback": "https://localhost:20021/oauth/callback",
  "virtual_numbers_pool": ["number1", "number2" ],
  "ewebrtc_domain": "your.ewebrtc_domain.com"
}
```

## Running the Server

**Note:** the sample app requires an Internet connection that is not restricted. If youâ€™re using a VPN, you must enable media streaming for the applicable ports.

### Installing Node.js dependencies

```bash
$ npm install
```

### Using the NPM `start` script

```bash
$ npm start
```

**Note**: The `start` script uses the sandbox environment by default. To start the DHS for other environments:

  * `sandbox` - Use this environment for your testing.

  ```bash
  $ node att-webrtc-dhs.js sandbox
  ```

  * `prod` - Use this environment when you are ready for production deployment.

  ```bash
  $ node att-webrtc-dhs.js prod
  ```


## Calling the RESTful API

### Getting the DHS Configuration
```
GET /config
```

#### Parameters

N/A

#### Response:
```javascript
{
  "dhs_name":"att.webrtc.dhs",
  "dhs_version":"1.0.0",
  "dhs_http_url":"http://your-domain.att-webrtc-dhs.com",
  "dhs_https_url":"https://your-domain-att-webrtc-hs.herokuapp.com",
  "cors_domains":[
    "your.test.com","*.prod.com","*.sandbox.myapp.com"
    ],
  "api_env":"test",
  "api_endpoint":"https://api.att.com",
  "token_uri":"/oauth/token",
  "authorize_uri":"/oauth/authorize",
  "oauth_callback":"https://localhost:20021/oauth/callback",
  "app_key":"YourAppKey",
  "scope_names":
    {
      "MOBILE_NUMBER":"WEBRTCMOBILE",
      "VIRTUAL_NUMBER":"WEBRTC",
      "ACCOUNT_ID":"WEBRTC",
      "E911":"EMERGENCYSERVICES"
    },
  "virtual_numbers_pool":[
    "number1",
    "Number2"
    ],
  "ewebrtc_domain":"your.ewebrtc_domain.com"
}
```

### Creating an Access Token

```
POST /tokens
```

#### Parameters

* Mobile Number Users:
  * `app_scope=MOBILE_NUMBER`
  * `auth_code=some_auth_code`
* Virtual Number Users:
  * `app_scope=VIRTUAL_NUMBER`
* Account ID Users:
  * `app_scope=ACCOUNT_ID`
* E911:
  * `app_scope=E911`

#### Response

This response is the same as that generated by directly calling the [AT&T OAuth API](http://developer.att.com/apis/oauth-2)

```javascript
{
  "access_token":"Access_Token",
  "token_type":"bearer",
  "expires_in":157680000,
  "refresh_token":"Refresh_Token"
}
```

### Creating an E911 Id

```
POST /e911ids
```

### Parameters
```javascript
{
  "access_token": "Access_Token",
  "first_name": "WebRTC",
  "last_name": "Tester",
  "house_number": "3844",
  "street": "165TH PL NE",
  "city": "Redmond",
  "state": "WA",
  "zip": "98052",
  "is_confirmed": "true",
  "comments": "Just Testing"
}
```

#### Response:
```javascript
{
  "e911Locations":
  {
    "addressIdentifier":"Identifier",
    "status":"Validated",
    "expirationDate":"-1"
  }
}
```
